{"version":3,"sources":["../src/panel-mainmenu.tsx"],"names":["MainMenuRoom","classType","userdetailsCache","roomsCache","receiveLine","args","cmd","challstr","PSLoginServer","query","act","then","res","loggedin","send","username","assertion","fullName","namedCode","avatar","PS","user","setName","challengesBuf","receiveChallenges","queryId","responseJSON","handleQueryResponse","JSON","parse","user1","user2","message","handlePM","parseFormats","alert","replace","lobby","rooms","dataBuf","json","userid","challengesFrom","getPMRoom","toID","challengeTo","to","roomid","room","pmTarget","targetUserid","challengedFormat","challengingFormat","format","update","formatsList","isSection","section","column","window","BattleFormats","j","length","entry","teams","usesLocalLadder","charAt","isNaN","Number","slice","parseInt","name","searchShow","challengeShow","tournamentShow","team","teambuilderLevel","lastCommaIndex","lastIndexOf","code","substr","NaN","id","isTeambuilderFormat","teambuilderFormat","teambuilderFormatName","parenPos","indexOf","trim","rated","effectType","multivariantFormats","battleFormat","userid1","userid2","sort","join","addRoom","response","userdetails","Object","assign","userRoom","pspl","roomInfo","spotlight","chat","official","roomsRoom","battlesRoom","battleTable","battles","battleid","push","ladderRoomEntries","entries","filter","startsWith","ladderRoom","PSRoom","NewsPanel","render","props","__html","newsHTML","PSRoomPanel","MainMenuPanel","submit","e","handleDragStart","currentTarget","getAttribute","dragging","type","focus","base","querySelector","renderMiniRoom","roomType","roomTypes","Panel","Component","renderMiniRooms","miniRoomList","map","title","renderSearchButton","down","textAlign","Config","routes","client","isOffline","onlineButton","display","leftRoomWidth","server","dex","replays","root","FormatDropdown","change","forceUpdate","onChange","getFormat","value","componentDidMount","preact","TeamDropdown","getTeam","key","byKey","formatid","list","formatData","teambox","TeamForm","state","changeFormat","setState","target","preventDefault","teamKey","undefined","onSubmit","children","Model"],"mappings":"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","sourcesContent":["/**\r\n * Main menu panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\ntype RoomInfo = {title: string, desc?: string, userCount?: number, section?: string, spotlight?: string, subRooms?: string[]};\r\n\r\nclass MainMenuRoom extends PSRoom {\r\n\treadonly classType: string = 'mainmenu';\r\n\tuserdetailsCache: {[userid: string]: {\r\n\t\tuserid: ID,\r\n\t\tavatar?: string | number,\r\n\t\tstatus?: string,\r\n\t\tgroup?: string,\r\n\t\tcustomgroup?: string,\r\n\t\trooms?: {[roomid: string]: {isPrivate?: true, p1?: string, p2?: string}},\r\n\t}} = {};\r\n\troomsCache: {\r\n\t\tbattleCount?: number,\r\n\t\tuserCount?: number,\r\n\t\tchat?: RoomInfo[],\r\n\t\tsectionTitles?: string[],\r\n\t} = {};\r\n\treceiveLine(args: Args) {\r\n\t\tconst [cmd] = args;\r\n\t\tswitch (cmd) {\r\n\t\tcase 'challstr': {\r\n\t\t\tconst [, challstr] = args;\r\n\t\t\tPSLoginServer.query({\r\n\t\t\t\tact: 'upkeep',\r\n\t\t\t\tchallstr,\r\n\t\t\t}).then(res => {\r\n\t\t\t\tif (!res) return;\r\n\t\t\t\tif (!res.loggedin) return;\r\n\t\t\t\tthis.send(`/trn ${res.username},0,${res.assertion}`);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t} case 'updateuser': {\r\n\t\t\tconst [, fullName, namedCode, avatar] = args;\r\n\t\t\tPS.user.setName(fullName, namedCode === '1', avatar);\r\n\t\t\treturn;\r\n\t\t} case 'updatechallenges': {\r\n\t\t\tconst [, challengesBuf] = args;\r\n\t\t\tthis.receiveChallenges(challengesBuf);\r\n\t\t\treturn;\r\n\t\t} case 'queryresponse': {\r\n\t\t\tconst [, queryId, responseJSON] = args;\r\n\t\t\tthis.handleQueryResponse(queryId as ID, JSON.parse(responseJSON));\r\n\t\t\treturn;\r\n\t\t} case 'pm': {\r\n\t\t\tconst [, user1, user2, message] = args;\r\n\t\t\tthis.handlePM(user1, user2, message);\r\n\t\t\treturn;\r\n\t\t} case 'formats': {\r\n\t\t\tthis.parseFormats(args);\r\n\t\t\treturn;\r\n\t\t} case 'popup': {\r\n\t\t\tconst [, message] = args;\r\n\t\t\talert(message.replace(/\\|\\|/g, '\\n'));\r\n\t\t\treturn;\r\n\t\t}}\r\n\t\tconst lobby = PS.rooms['lobby'];\r\n\t\tif (lobby) lobby.receiveLine(args);\r\n\t}\r\n\treceiveChallenges(dataBuf: string) {\r\n\t\tlet json;\r\n\t\ttry {\r\n\t\t\tjson = JSON.parse(dataBuf);\r\n\t\t} catch {}\r\n\t\tfor (const userid in json.challengesFrom) {\r\n\t\t\tPS.getPMRoom(toID(userid));\r\n\t\t}\r\n\t\tif (json.challengeTo) {\r\n\t\t\tPS.getPMRoom(toID(json.challengeTo.to));\r\n\t\t}\r\n\t\tfor (const roomid in PS.rooms) {\r\n\t\t\tconst room = PS.rooms[roomid] as ChatRoom;\r\n\t\t\tif (!room.pmTarget) continue;\r\n\t\t\tconst targetUserid = toID(room.pmTarget);\r\n\t\t\tif (!room.challengedFormat && !(targetUserid in json.challengesFrom) &&\r\n\t\t\t\t!room.challengingFormat && json.challengeTo?.to !== targetUserid) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\troom.challengedFormat = json.challengesFrom[targetUserid] || null;\r\n\t\t\troom.challengingFormat = json.challengeTo?.to === targetUserid ? json.challengeTo.format : null;\r\n\t\t\troom.update(null);\r\n\t\t}\r\n\t}\r\n\tparseFormats(formatsList: string[]) {\r\n\t\tlet isSection = false;\r\n\t\tlet section = '';\r\n\r\n\t\tlet column = 0;\r\n\r\n\t\twindow.BattleFormats = {};\r\n\t\tfor (let j = 1; j < formatsList.length; j++) {\r\n\t\t\tconst entry = formatsList[j];\r\n\t\t\tif (isSection) {\r\n\t\t\t\tsection = entry;\r\n\t\t\t\tisSection = false;\r\n\t\t\t} else if (entry === ',LL') {\r\n\t\t\t\tPS.teams.usesLocalLadder = true;\r\n\t\t\t} else if (entry === '' || (entry.charAt(0) === ',' && !isNaN(Number(entry.slice(1))))) {\r\n\t\t\t\tisSection = true;\r\n\r\n\t\t\t\tif (entry) {\r\n\t\t\t\t\tcolumn = parseInt(entry.slice(1), 10) || 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet name = entry;\r\n\t\t\t\tlet searchShow = true;\r\n\t\t\t\tlet challengeShow = true;\r\n\t\t\t\tlet tournamentShow = true;\r\n\t\t\t\tlet team: 'preset' | null = null;\r\n\t\t\t\tlet teambuilderLevel: number | null = null;\r\n\t\t\t\tlet lastCommaIndex = name.lastIndexOf(',');\r\n\t\t\t\tlet code = lastCommaIndex >= 0 ? parseInt(name.substr(lastCommaIndex + 1), 16) : NaN;\r\n\t\t\t\tif (!isNaN(code)) {\r\n\t\t\t\t\tname = name.substr(0, lastCommaIndex);\r\n\t\t\t\t\tif (code & 1) team = 'preset';\r\n\t\t\t\t\tif (!(code & 2)) searchShow = false;\r\n\t\t\t\t\tif (!(code & 4)) challengeShow = false;\r\n\t\t\t\t\tif (!(code & 8)) tournamentShow = false;\r\n\t\t\t\t\tif (code & 16) teambuilderLevel = 50;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Backwards compatibility: late 0.9.0 -> 0.10.0\r\n\t\t\t\t\tif (name.substr(name.length - 2) === ',#') { // preset teams\r\n\t\t\t\t\t\tteam = 'preset';\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (name.substr(name.length - 2) === ',,') { // search-only\r\n\t\t\t\t\t\tchallengeShow = false;\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\r\n\t\t\t\t\t} else if (name.substr(name.length - 1) === ',') { // challenge-only\r\n\t\t\t\t\t\tsearchShow = false;\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet id = toID(name);\r\n\t\t\t\tlet isTeambuilderFormat = !team && name.slice(-11) !== 'Custom Game';\r\n\t\t\t\tlet teambuilderFormat = '' as ID;\r\n\t\t\t\tlet teambuilderFormatName = '';\r\n\t\t\t\tif (isTeambuilderFormat) {\r\n\t\t\t\t\tteambuilderFormatName = name;\r\n\t\t\t\t\tif (id.slice(0, 3) !== 'gen') {\r\n\t\t\t\t\t\tteambuilderFormatName = '[Gen 6] ' + name;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet parenPos = teambuilderFormatName.indexOf('(');\r\n\t\t\t\t\tif (parenPos > 0 && name.slice(-1) === ')') {\r\n\t\t\t\t\t\t// variation of existing tier\r\n\t\t\t\t\t\tteambuilderFormatName = teambuilderFormatName.slice(0, parenPos).trim();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (teambuilderFormatName !== name) {\r\n\t\t\t\t\t\tteambuilderFormat = toID(teambuilderFormatName);\r\n\t\t\t\t\t\tif (BattleFormats[teambuilderFormat]) {\r\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat].isTeambuilderFormat = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat] = {\r\n\t\t\t\t\t\t\t\tid: teambuilderFormat,\r\n\t\t\t\t\t\t\t\tname: teambuilderFormatName,\r\n\t\t\t\t\t\t\t\tteam,\r\n\t\t\t\t\t\t\t\tsection,\r\n\t\t\t\t\t\t\t\tcolumn,\r\n\t\t\t\t\t\t\t\trated: false,\r\n\t\t\t\t\t\t\t\tisTeambuilderFormat: true,\r\n\t\t\t\t\t\t\t\teffectType: 'Format',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tisTeambuilderFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (BattleFormats[id]?.isTeambuilderFormat) {\r\n\t\t\t\t\tisTeambuilderFormat = true;\r\n\t\t\t\t}\r\n\t\t\t\t// make sure formats aren't out-of-order\r\n\t\t\t\tif (BattleFormats[id]) delete BattleFormats[id];\r\n\t\t\t\tBattleFormats[id] = {\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tteam,\r\n\t\t\t\t\tsection,\r\n\t\t\t\t\tcolumn,\r\n\t\t\t\t\tsearchShow,\r\n\t\t\t\t\tchallengeShow,\r\n\t\t\t\t\ttournamentShow,\r\n\t\t\t\t\trated: searchShow && id.substr(4, 7) !== 'unrated',\r\n\t\t\t\t\tteambuilderLevel,\r\n\t\t\t\t\tteambuilderFormat,\r\n\t\t\t\t\tisTeambuilderFormat,\r\n\t\t\t\t\teffectType: 'Format',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Match base formats to their variants, if they are unavailable in the server.\r\n\t\tlet multivariantFormats: {[id: string]: 1} = {};\r\n\t\tfor (let id in BattleFormats) {\r\n\t\t\tlet teambuilderFormat = BattleFormats[BattleFormats[id].teambuilderFormat!];\r\n\t\t\tif (!teambuilderFormat || multivariantFormats[teambuilderFormat.id]) continue;\r\n\t\t\tif (!teambuilderFormat.searchShow && !teambuilderFormat.challengeShow && !teambuilderFormat.tournamentShow) {\r\n\t\t\t\t// The base format is not available.\r\n\t\t\t\tif (teambuilderFormat.battleFormat) {\r\n\t\t\t\t\tmultivariantFormats[teambuilderFormat.id] = 1;\r\n\t\t\t\t\tteambuilderFormat.battleFormat = '';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tteambuilderFormat.battleFormat = id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tPS.teams.update('format');\r\n\t}\r\n\thandlePM(user1: string, user2: string, message: string) {\r\n\t\tconst userid1 = toID(user1);\r\n\t\tconst userid2 = toID(user2);\r\n\t\tconst roomid = `pm-${[userid1, userid2].sort().join('-')}` as RoomID;\r\n\t\tlet room = PS.rooms[roomid];\r\n\t\tif (!room) {\r\n\t\t\tconst pmTarget = PS.user.userid === userid1 ? user2 : user1;\r\n\t\t\tPS.addRoom({\r\n\t\t\t\tid: roomid,\r\n\t\t\t\tpmTarget,\r\n\t\t\t}, true);\r\n\t\t\troom = PS.rooms[roomid]!;\r\n\t\t}\r\n\t\troom.receiveLine([`c`, user1, message]);\r\n\t\tPS.update();\r\n\t}\r\n\thandleQueryResponse(id: ID, response: any) {\r\n\t\tswitch (id) {\r\n\t\tcase 'userdetails':\r\n\t\t\tlet userid = response.userid;\r\n\t\t\tlet userdetails = this.userdetailsCache[userid];\r\n\t\t\tif (!userdetails) {\r\n\t\t\t\tthis.userdetailsCache[userid] = response;\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(userdetails, response);\r\n\t\t\t}\r\n\t\t\tconst userRoom = PS.rooms[`user-${userid}`] as UserRoom;\r\n\t\t\tif (userRoom) userRoom.update(null);\r\n\t\t\tbreak;\r\n\t\tcase 'rooms':\r\n\t\t\tif (response.pspl) {\r\n\t\t\t\tfor (const roomInfo of response.pspl) roomInfo.spotlight = \"Spotlight\";\r\n\t\t\t\tresponse.chat = [...response.pspl, ...response.chat];\r\n\t\t\t\tresponse.pspl = null;\r\n\t\t\t}\r\n\t\t\tif (response.official) {\r\n\t\t\t\tfor (const roomInfo of response.official) roomInfo.section = \"Official\";\r\n\t\t\t\tresponse.chat = [...response.official, ...response.chat];\r\n\t\t\t\tresponse.official = null;\r\n\t\t\t}\r\n\t\t\tthis.roomsCache = response;\r\n\t\t\tconst roomsRoom = PS.rooms[`rooms`] as RoomsRoom;\r\n\t\t\tif (roomsRoom) roomsRoom.update(null);\r\n\t\t\tbreak;\r\n\t\tcase 'roomlist':\r\n\t\t\tconst battlesRoom = PS.rooms[`battles`] as BattlesRoom;\r\n\t\t\tif (battlesRoom) {\r\n\t\t\t\tconst battleTable = response.rooms;\r\n\t\t\t\tconst battles = [];\r\n\t\t\t\tfor (const battleid in battleTable) {\r\n\t\t\t\t\tbattleTable[battleid].id = battleid;\r\n\t\t\t\t\tbattles.push(battleTable[battleid]);\r\n\t\t\t\t}\r\n\t\t\t\tbattlesRoom.battles = battles;\r\n\t\t\t\tbattlesRoom.update(null);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'laddertop':\r\n\t\t\tconst ladderRoomEntries = Object.entries(PS.rooms).filter(entry => entry[0].startsWith('ladder'));\r\n\t\t\tfor (const [, ladderRoom] of ladderRoomEntries) {\r\n\t\t\t\t(ladderRoom as LadderRoom).update(response);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass NewsPanel extends PSRoomPanel {\r\n\trender() {\r\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable>\r\n\t\t\t<div class=\"mini-window-body\" dangerouslySetInnerHTML={{__html: PS.newsHTML}}></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass MainMenuPanel extends PSRoomPanel<MainMenuRoom> {\r\n\tfocus() {\r\n\t\t(this.base!.querySelector('button.big') as HTMLButtonElement).focus();\r\n\t}\r\n\tsubmit = (e: Event) => {\r\n\t\talert('todo: implement');\r\n\t};\r\n\thandleDragStart = (e: DragEvent) => {\r\n\t\tconst roomid = (e.currentTarget as HTMLElement).getAttribute('data-roomid') as RoomID;\r\n\t\tPS.dragging = {type: 'room', roomid};\r\n\t};\r\n\trenderMiniRoom(room: PSRoom) {\r\n\t\tconst roomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = roomType ? roomType.Component : PSRoomPanel;\r\n\t\treturn <Panel key={room.id} room={room} />;\r\n\t}\r\n\trenderMiniRooms() {\r\n\t\treturn PS.miniRoomList.map(roomid => {\r\n\t\t\tconst room = PS.rooms[roomid]!;\r\n\t\t\treturn <div class=\"pmbox\">\r\n\t\t\t\t<div class=\"mini-window\">\r\n\t\t\t\t\t<h3 draggable onDragStart={this.handleDragStart} data-roomid={roomid}>\r\n\t\t\t\t\t\t<button class=\"closebutton\" name=\"closeRoom\" value={roomid} aria-label=\"Close\" tabIndex={-1}><i class=\"fa fa-times-circle\"></i></button>\r\n\t\t\t\t\t\t<button class=\"minimizebutton\" tabIndex={-1}><i class=\"fa fa-minus-circle\"></i></button>\r\n\t\t\t\t\t\t{room.title}\r\n\t\t\t\t\t</h3>\r\n\t\t\t\t\t{this.renderMiniRoom(room)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t}\r\n\trenderSearchButton() {\r\n\t\tif (PS.down) {\r\n\t\t\treturn <div class=\"menugroup\" style=\"background: rgba(10,10,10,.6)\">\r\n\t\t\t\t{PS.down === 'ddos' ?\r\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to a DDoS attack!</strong></p>\r\n\t\t\t\t:\r\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to technical difficulties!</strong></p>\r\n\t\t\t\t}\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<div style={{textAlign: 'center'}}>\r\n\t\t\t\t\t\t<img width=\"96\" height=\"96\" src={`//${Config.routes.client}/sprites/gen5/teddiursa.png`} alt=\"\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\tBear with us as we freak out.\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>(We'll be back up in a few hours.)</p>\r\n\t\t\t</div>;\r\n\t\t}\r\n\r\n\t\tif (!PS.user.userid || PS.isOffline) {\r\n\t\t\treturn <TeamForm class=\"menugroup\" onSubmit={this.submit}>\r\n\t\t\t\t<button class=\"mainmenu1 big button disabled\" name=\"search\">\r\n\t\t\t\t\t<em>{PS.isOffline ? \"Disconnected\" : \"Connecting...\"}</em>\r\n\t\t\t\t</button>\r\n\t\t\t</TeamForm>;\r\n\t\t}\r\n\r\n\t\treturn <TeamForm class=\"menugroup\" onSubmit={this.submit}>\r\n\t\t\t<button class=\"mainmenu1 big button\" name=\"search\">\r\n\t\t\t\t<strong>Battle!</strong><br />\r\n\t\t\t\t<small>Find a random opponent</small>\r\n\t\t\t</button>\r\n\t\t</TeamForm>;\r\n\t}\r\n\trender() {\r\n\t\tconst onlineButton = ' button' + (PS.isOffline ? ' disabled' : '');\r\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable>\r\n\t\t\t<div class=\"mainmenuwrapper\">\r\n\t\t\t\t<div class=\"leftmenu\">\r\n\t\t\t\t\t<div class=\"activitymenu\">\r\n\t\t\t\t\t\t{this.renderMiniRooms()}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"mainmenu\">\r\n\t\t\t\t\t\t{this.renderSearchButton()}\r\n\r\n\t\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t\t<p><button class=\"mainmenu2 button\" name=\"joinRoom\" value=\"teambuilder\">Teambuilder</button></p>\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu3\" + onlineButton} name=\"joinRoom\" value=\"ladder\">Ladder</button></p>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu4\" + onlineButton} name=\"joinRoom\" value=\"battles\">Watch a battle</button></p>\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu5\" + onlineButton} name=\"finduser\">Find a user</button></p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"rightmenu\" style={{display: PS.leftRoomWidth ? 'none' : 'block'}}>\r\n\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t{PS.server.id === 'showdown' ?\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu1\" + onlineButton} name=\"joinRoom\" value=\"rooms\">Join chat</button></p>\r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<p><button class={\"mainmenu1\" + onlineButton} name=\"joinRoom\" value=\"lobby\">Join lobby chat</button></p>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"mainmenufooter\">\r\n\t\t\t\t\t<div class=\"bgcredit\"></div>\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/`} target=\"_blank\">Pok&eacute;dex</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.replays}/`} target=\"_blank\">Replays</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.root}/rules`} target=\"_blank\">Rules</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/credits`} target=\"_blank\">Credits</a> | {}\r\n\t\t\t\t\t\t<a href=\"//smogon.com/forums/\" target=\"_blank\">Forum</a>\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass FormatDropdown extends preact.Component<{format?: string, onChange?: JSX.EventHandler<Event>}> {\r\n\tbase?: HTMLButtonElement;\r\n\tgetFormat() {\r\n\t\treturn this.base?.value || '[Gen 7] Random Battle';\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\tthis.base!.value = this.getFormat();\r\n\t}\r\n\tchange = (e: Event) => {\r\n\t\tthis.forceUpdate();\r\n\t\tif (this.props.onChange) this.props.onChange(e);\r\n\t};\r\n\trender() {\r\n\t\tif (this.props.format) {\r\n\t\t\treturn <button\r\n\t\t\t\tclass=\"select formatselect preselected\" name=\"format\" value={this.props.format} disabled\r\n\t\t\t>{this.props.format}</button>;\r\n\t\t}\r\n\t\tconst format = this.getFormat();\r\n\t\treturn <button class=\"select formatselect\" name=\"format\" data-href=\"/formatdropdown\" onChange={this.change}>\r\n\t\t\t{format}\r\n\t\t</button>;\r\n\t}\r\n}\r\n\r\nclass TeamDropdown extends preact.Component<{format: string}> {\r\n\tbase?: HTMLButtonElement;\r\n\tgetTeam() {\r\n\t\tif (this.base) {\r\n\t\t\tconst key = this.base.value;\r\n\t\t\treturn PS.teams.byKey[key] || null;\r\n\t\t}\r\n\t\tconst formatid = PS.teams.teambuilderFormat(this.props.format);\r\n\t\tfor (const team of PS.teams.list) {\r\n\t\t\tif (team.format === formatid) return team;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tcomponentDidMount() {\r\n\t\tconst team = this.getTeam();\r\n\t\tif (team) {\r\n\t\t\tthis.base!.value = team.key;\r\n\t\t}\r\n\t}\r\n\tchange = () => this.forceUpdate();\r\n\trender() {\r\n\t\tconst formatid = PS.teams.teambuilderFormat(this.props.format);\r\n\t\tconst formatData = window.BattleFormats?.[formatid];\r\n\t\tif (formatData && formatData.team) {\r\n\t\t\treturn <button class=\"select teamselect preselected\" name=\"team\" value=\"random\" disabled>\r\n\t\t\t\t<div class=\"team\">\r\n\t\t\t\t\t<strong>Random team</strong>\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\r\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>\r\n\t\t\t</button>;\r\n\t\t}\r\n\t\tconst team = this.getTeam();\r\n\t\tlet teambox = null;\r\n\t\tif (PS.roomTypes['teamdropdown']) {\r\n\t\t\tteambox = <TeamBox team={team} noLink />;\r\n\t\t}\r\n\t\treturn <button class=\"select teamselect\" name=\"team\" data-href=\"/teamdropdown\" data-format={formatid} onChange={this.change}>\r\n\t\t\t{teambox}\r\n\t\t</button>;\r\n\t}\r\n}\r\n\r\nclass TeamForm extends preact.Component<{\r\n\tchildren: preact.ComponentChildren, class?: string, format?: string,\r\n\tonSubmit: null | ((e: Event, format: string, team?: Team) => void),\r\n}> {\r\n\tstate = {format: '[Gen 7] Random Battle'};\r\n\tchangeFormat = (e: Event) => {\r\n\t\tthis.setState({format: (e.target as HTMLButtonElement).value});\r\n\t};\r\n\tsubmit = (e: Event) => {\r\n\t\te.preventDefault();\r\n\t\tconst format = (this.base!.querySelector('button[name=format]') as HTMLButtonElement).value;\r\n\t\tconst teamKey = (this.base!.querySelector('button[name=team]') as HTMLButtonElement).value;\r\n\t\tconst team = teamKey ? PS.teams.byKey[teamKey] : undefined;\r\n\t\tif (this.props.onSubmit) this.props.onSubmit(e, format, team);\r\n\t};\r\n\trender() {\r\n\t\treturn <form class={this.props.class} onSubmit={this.submit}>\r\n\t\t\t<p>\r\n\t\t\t\t<label class=\"label\">\r\n\t\t\t\t\tFormat:<br />\r\n\t\t\t\t\t<FormatDropdown onChange={this.changeFormat} format={this.props.format} />\r\n\t\t\t\t</label>\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\t<label class=\"label\">\r\n\t\t\t\t\tTeam:<br />\r\n\t\t\t\t\t<TeamDropdown format={this.state.format} />\r\n\t\t\t\t</label>\r\n\t\t\t</p>\r\n\t\t\t<p>{this.props.children}</p>\r\n\t\t</form>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['news'] = {\r\n\tComponent: NewsPanel,\r\n};\r\n\r\nPS.roomTypes['mainmenu'] = {\r\n\tModel: MainMenuRoom,\r\n\tComponent: MainMenuPanel,\r\n};\r\n"],"file":"panel-mainmenu.js"}